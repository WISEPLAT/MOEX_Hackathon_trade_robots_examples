//let data = {'name': 'Фондовые индексы Московской Биржи', 'children': [{'name': 'IMOEX', 'children': [{'name': 'LKOH', 'name_rus': 'ЛУКОЙЛ', 'volume': 1125.99, 'value': 0, 'price': 7320.0, 'pc': 0.34}, {'name': 'SBER', 'name_rus': 'Сбербанк', 'volume': 4153.33, 'value': 0, 'price': 288.1, 'pc': 0.44}, {'name': 'GAZP', 'name_rus': 'ГАЗПРОМ ао', 'volume': 1063.65, 'value': 0, 'price': 164.25, 'pc': -0.28}, {'name': 'GMKN', 'name_rus': 'ГМКНорНик', 'volume': 336.38, 'value': 0, 'price': 17194.0, 'pc': 0.57}, {'name': 'TATN', 'name_rus': 'Татнфт 3ао', 'volume': 453.29, 'value': 0, 'price': 646.4, 'pc': -0.25}, {'name': 'NVTK', 'name_rus': 'Новатэк ао', 'volume': 155.03, 'value': 0, 'price': 1515.0, 'pc': 0.07}, {'name': 'SNGS', 'name_rus': 'Сургнфгз', 'volume': 52.76, 'value': 0, 'price': 31.965, 'pc': -0.3}, {'name': 'SNGS', 'name_rus': 'Сургнфгз-п', 'volume': 189.9, 'value': 0, 'price': 58.475, 'pc': -0.11}, {'name': 'SBER', 'name_rus': 'Сбербанк-п', 'volume': 290.51, 'value': 0, 'price': 287.8, 'pc': 0.5}, {'name': 'PLZL', 'name_rus': 'Полюс', 'volume': 85.86, 'value': 0, 'price': 11203.0, 'pc': -0.02}, {'name': 'ROSN', 'name_rus': 'Роснефть', 'volume': 348.87, 'value': 0, 'price': 582.7, 'pc': 0.67}, {'name': 'RUAL', 'name_rus': 'РУСАЛ ао', 'volume': 113.84, 'value': 0, 'price': 37.85, 'pc': -0.33}, {'name': 'PIKK', 'name_rus': 'ПИК ао', 'volume': 32.65, 'value': 0, 'price': 704.5, 'pc': -0.18}, {'name': 'CHMF', 'name_rus': 'СевСт-ао', 'volume': 231.19, 'value': 0, 'price': 1305.6, 'pc': -0.88}, {'name': 'MGNT', 'name_rus': 'Магнит ао', 'volume': 1830.2, 'value': 0, 'price': 6316.5, 'pc': -0.1}, {'name': 'IRAO', 'name_rus': 'ИнтерРАОао', 'volume': 62.01, 'value': 0, 'price': 4.238, 'pc': 0.21}, {'name': 'NLMK', 'name_rus': 'НЛМК ао', 'volume': 496.43, 'value': 0, 'price': 178.76, 'pc': -1.88}, {'name': 'YNDX', 'name_rus': 'Yandex clA', 'volume': 566.98, 'value': 0, 'price': 2623.8, 'pc': 1.13}, {'name': 'MAGN', 'name_rus': 'ММК', 'volume': 90.08, 'value': 0, 'price': 51.87, 'pc': 0.46}, {'name': 'ALRS', 'name_rus': 'АЛРОСА ао', 'volume': 108.8, 'value': 0, 'price': 66.22, 'pc': 0.32}, {'name': 'MTSS', 'name_rus': 'МТС-ао', 'volume': 169.77, 'value': 0, 'price': 262.05, 'pc': -0.3}, {'name': 'MOEX', 'name_rus': 'МосБиржа', 'volume': 594.21, 'value': 0, 'price': 207.92, 'pc': 1.24}, {'name': 'VTBR', 'name_rus': 'ВТБ ао', 'volume': 314.07, 'value': 0, 'price': 0.02483, 'pc': -0.06}, {'name': 'TATN', 'name_rus': 'Татнфт 3ап', 'volume': 80.24, 'value': 0, 'price': 645.7, 'pc': -0.34}, {'name': 'RTKM', 'name_rus': 'Ростел -ао', 'volume': 95.2, 'value': 0, 'price': 81.25, 'pc': 0.46}, {'name': 'AGRO', 'name_rus': 'AGRO-гдр', 'volume': 85.12, 'value': 0, 'price': 1486.8, 'pc': -0.92}, {'name': 'OZON', 'name_rus': 'OZON-адр', 'volume': 192.86, 'value': 0, 'price': 2867.0, 'pc': -0.97}, {'name': 'PHOR', 'name_rus': 'ФосАгро ао', 'volume': 36.63, 'value': 0, 'price': 6736.0, 'pc': -0.28}, {'name': 'ENPG', 'name_rus': 'ЭН+ГРУП ао', 'volume': 35.87, 'value': 0, 'price': 470.2, 'pc': -1.43}, {'name': 'TCSG', 'name_rus': 'TCS-гдр', 'volume': 244.19, 'value': 0, 'price': 3446.5, 'pc': -0.65}, {'name': 'CBOM', 'name_rus': 'МКБ ао', 'volume': 26.01, 'value': 0, 'price': 7.654, 'pc': -0.14}, {'name': 'TRNFP', 'name_rus': 'Транснф ап', 'volume': 347.53, 'value': 0, 'price': 146400.0, 'pc': 0.72}, {'name': 'AFKS', 'name_rus': 'Система ао', 'volume': 53.24, 'value': 0, 'price': 16.647, 'pc': -0.17}, {'name': 'AFLT', 'name_rus': 'Аэрофлот', 'volume': 45.7, 'value': 0, 'price': 38.29, 'pc': -0.57}, {'name': 'FEES', 'name_rus': 'Россети', 'volume': 189.69, 'value': 0, 'price': 0.1164, 'pc': -1.34}, {'name': 'FIVE', 'name_rus': 'FIVE-гдр', 'volume': 61.32, 'value': 0, 'price': 2174.0, 'pc': -0.23}, {'name': 'VKCO', 'name_rus': 'МКПАО "ВК"', 'volume': 374.68, 'value': 0, 'price': 618.2, 'pc': -1.28}, {'name': 'SELG', 'name_rus': 'Селигдар', 'volume': 117.04, 'value': 0, 'price': 68.95, 'pc': -2.3}, {'name': 'POSI', 'name_rus': 'iПозитив', 'volume': 49.62, 'value': 0, 'price': 2143.4, 'pc': -0.2}, {'name': 'UPRO', 'name_rus': 'Юнипро ао', 'volume': 91.38, 'value': 0, 'price': 2.147, 'pc': -1.24}, {'name': 'QIWI', 'name_rus': 'iQIWI', 'volume': 6.97, 'value': 0, 'price': 545.5, 'pc': -1.27}, {'name': 'HYDR', 'name_rus': 'РусГидро', 'volume': 175.84, 'value': 0, 'price': 0.8126, 'pc': 2.39}, {'name': 'SGZH', 'name_rus': 'Сегежа', 'volume': 438.61, 'value': 0, 'price': 3.908, 'pc': -0.81}, {'name': 'POLY', 'name_rus': 'Polymetal', 'volume': 1131.1, 'value': 0, 'price': 422.8, 'pc': 6.9}, {'name': 'GLTR', 'name_rus': 'GLTR-гдр', 'volume': 39.63, 'value': 0, 'price': 620.65, 'pc': 0.4}]}, {'name': 'MOEXBMI', 'children': [{'name': 'LKOH', 'name_rus': 'ЛУКОЙЛ', 'volume': 1125.99, 'value': 0, 'price': 7320.0, 'pc': 0.34}, {'name': 'SBER', 'name_rus': 'Сбербанк', 'volume': 4153.33, 'value': 0, 'price': 288.1, 'pc': 0.44}, {'name': 'GAZP', 'name_rus': 'ГАЗПРОМ ао', 'volume': 1063.65, 'value': 0, 'price': 164.25, 'pc': -0.28}, {'name': 'GMKN', 'name_rus': 'ГМКНорНик', 'volume': 336.38, 'value': 0, 'price': 17194.0, 'pc': 0.57}, {'name': 'TATN', 'name_rus': 'Татнфт 3ао', 'volume': 453.29, 'value': 0, 'price': 646.4, 'pc': -0.25}, {'name': 'SNGS', 'name_rus': 'Сургнфгз', 'volume': 52.76, 'value': 0, 'price': 31.965, 'pc': -0.3}, {'name': 'NVTK', 'name_rus': 'Новатэк ао', 'volume': 155.03, 'value': 0, 'price': 1515.0, 'pc': 0.07}, {'name': 'SBER', 'name_rus': 'Сбербанк-п', 'volume': 290.51, 'value': 0, 'price': 287.8, 'pc': 0.5}, {'name': 'SNGS', 'name_rus': 'Сургнфгз-п', 'volume': 189.9, 'value': 0, 'price': 58.475, 'pc': -0.11}, {'name': 'PLZL', 'name_rus': 'Полюс', 'volume': 85.86, 'value': 0, 'price': 11203.0, 'pc': -0.02}, {'name': 'ROSN', 'name_rus': 'Роснефть', 'volume': 348.87, 'value': 0, 'price': 582.7, 'pc': 0.67}, {'name': 'RUAL', 'name_rus': 'РУСАЛ ао', 'volume': 113.84, 'value': 0, 'price': 37.85, 'pc': -0.33}, {'name': 'PIKK', 'name_rus': 'ПИК ао', 'volume': 32.65, 'value': 0, 'price': 704.5, 'pc': -0.18}, {'name': 'CHMF', 'name_rus': 'СевСт-ао', 'volume': 231.19, 'value': 0, 'price': 1305.6, 'pc': -0.88}, {'name': 'MGNT', 'name_rus': 'Магнит ао', 'volume': 1830.2, 'value': 0, 'price': 6316.5, 'pc': -0.1}, {'name': 'IRAO', 'name_rus': 'ИнтерРАОао', 'volume': 62.01, 'value': 0, 'price': 4.238, 'pc': 0.21}, {'name': 'NLMK', 'name_rus': 'НЛМК ао', 'volume': 496.43, 'value': 0, 'price': 178.76, 'pc': -1.88}, {'name': 'YNDX', 'name_rus': 'Yandex clA', 'volume': 566.98, 'value': 0, 'price': 2623.8, 'pc': 1.13}, {'name': 'MAGN', 'name_rus': 'ММК', 'volume': 90.08, 'value': 0, 'price': 51.87, 'pc': 0.46}, {'name': 'TATN', 'name_rus': 'Татнфт 3ап', 'volume': 80.24, 'value': 0, 'price': 645.7, 'pc': -0.34}, {'name': 'ALRS', 'name_rus': 'АЛРОСА ао', 'volume': 108.8, 'value': 0, 'price': 66.22, 'pc': 0.32}, {'name': 'MTSS', 'name_rus': 'МТС-ао', 'volume': 169.77, 'value': 0, 'price': 262.05, 'pc': -0.3}, {'name': 'MOEX', 'name_rus': 'МосБиржа', 'volume': 594.21, 'value': 0, 'price': 207.92, 'pc': 1.24}, {'name': 'VTBR', 'name_rus': 'ВТБ ао', 'volume': 314.07, 'value': 0, 'price': 0.02483, 'pc': -0.06}, {'name': 'RTKM', 'name_rus': 'Ростел -ао', 'volume': 95.2, 'value': 0, 'price': 81.25, 'pc': 0.46}, {'name': 'AGRO', 'name_rus': 'AGRO-гдр', 'volume': 85.12, 'value': 0, 'price': 1486.8, 'pc': -0.92}, {'name': 'KAZT', 'name_rus': 'Куйбазот', 'volume': 18.76, 'value': 0, 'price': 707.6, 'pc': 2.02}, {'name': 'OZON', 'name_rus': 'OZON-адр', 'volume': 192.86, 'value': 0, 'price': 2867.0, 'pc': -0.97}, {'name': 'PHOR', 'name_rus': 'ФосАгро ао', 'volume': 36.63, 'value': 0, 'price': 6736.0, 'pc': -0.28}, {'name': 'ENPG', 'name_rus': 'ЭН+ГРУП ао', 'volume': 35.87, 'value': 0, 'price': 470.2, 'pc': -1.43}, {'name': 'TCSG', 'name_rus': 'TCS-гдр', 'volume': 244.19, 'value': 0, 'price': 3446.5, 'pc': -0.65}, {'name': 'CBOM', 'name_rus': 'МКБ ао', 'volume': 26.01, 'value': 0, 'price': 7.654, 'pc': -0.14}, {'name': 'FLOT', 'name_rus': 'Совкомфлот', 'volume': 558.58, 'value': 0, 'price': 131.13, 'pc': 1.56}, {'name': 'TRNFP', 'name_rus': 'Транснф ап', 'volume': 347.53, 'value': 0, 'price': 146400.0, 'pc': 0.72}, {'name': 'MTLR', 'name_rus': 'Мечел ао', 'volume': 2982.82, 'value': 0, 'price': 301.63, 'pc': -2.56}, {'name': 'VSMO', 'name_rus': 'ВСМПО-АВСМ', 'volume': 35.05, 'value': 0, 'price': 34060.0, 'pc': -4.06}, {'name': 'AFKS', 'name_rus': 'Система ао', 'volume': 53.24, 'value': 0, 'price': 16.647, 'pc': -0.17}, {'name': 'AFLT', 'name_rus': 'Аэрофлот', 'volume': 45.7, 'value': 0, 'price': 38.29, 'pc': -0.57}, {'name': 'AKRN', 'name_rus': 'Акрон', 'volume': 2.86, 'value': 0, 'price': 18830.0, 'pc': -0.53}, {'name': 'FEES', 'name_rus': 'Россети', 'volume': 189.69, 'value': 0, 'price': 0.1164, 'pc': -1.34}, {'name': 'KZOS', 'name_rus': 'ОргСинт ао', 'volume': 15.0, 'value': 0, 'price': 107.8, 'pc': -3.84}, {'name': 'BANE', 'name_rus': 'Башнефт ап', 'volume': 182.37, 'value': 0, 'price': 1765.5, 'pc': 1.0}, {'name': 'FIVE', 'name_rus': 'FIVE-гдр', 'volume': 61.32, 'value': 0, 'price': 2174.0, 'pc': -0.23}, {'name': 'MTLR', 'name_rus': 'Мечел ап', 'volume': 448.12, 'value': 0, 'price': 359.1, 'pc': -1.52}, {'name': 'SMLT', 'name_rus': 'Самолет ао', 'volume': 77.54, 'value': 0, 'price': 3986.5, 'pc': -0.15}, {'name': 'VKCO', 'name_rus': 'МКПАО "ВК"', 'volume': 374.68, 'value': 0, 'price': 618.2, 'pc': -1.28}, {'name': 'FESH', 'name_rus': 'ДВМП ао', 'volume': 260.21, 'value': 0, 'price': 80.97, 'pc': -3.41}, {'name': 'NMTP', 'name_rus': 'НМТП ао', 'volume': 119.91, 'value': 0, 'price': 11.055, 'pc': -2.17}, {'name': 'MSNG', 'name_rus': '+МосЭнерго', 'volume': 9.91, 'value': 0, 'price': 3.0535, 'pc': 0.66}, {'name': 'SELG', 'name_rus': 'Селигдар', 'volume': 117.04, 'value': 0, 'price': 68.95, 'pc': -2.3}, {'name': 'POSI', 'name_rus': 'iПозитив', 'volume': 49.62, 'value': 0, 'price': 2143.4, 'pc': -0.2}, {'name': 'UPRO', 'name_rus': 'Юнипро ао', 'volume': 91.38, 'value': 0, 'price': 2.147, 'pc': -1.24}, {'name': 'QIWI', 'name_rus': 'iQIWI', 'volume': 6.97, 'value': 0, 'price': 545.5, 'pc': -1.27}, {'name': 'BSPB', 'name_rus': 'БСП ао', 'volume': 232.32, 'value': 0, 'price': 237.51, 'pc': -1.86}, {'name': 'HYDR', 'name_rus': 'РусГидро', 'volume': 175.84, 'value': 0, 'price': 0.8126, 'pc': 2.39}, {'name': 'NKNC', 'name_rus': 'НКНХ ао', 'volume': 26.64, 'value': 0, 'price': 106.7, 'pc': -5.99}, {'name': 'POLY', 'name_rus': 'Polymetal', 'volume': 1131.1, 'value': 0, 'price': 422.8, 'pc': 6.9}, {'name': 'SGZH', 'name_rus': 'Сегежа', 'volume': 438.61, 'value': 0, 'price': 3.908, 'pc': -0.81}, {'name': 'LENT', 'name_rus': 'Лента ао', 'volume': 2.18, 'value': 0, 'price': 712.5, 'pc': -0.07}, {'name': 'GLTR', 'name_rus': 'GLTR-гдр', 'volume': 39.63, 'value': 0, 'price': 620.65, 'pc': 0.4}, {'name': 'RASP', 'name_rus': 'Распадская', 'volume': 206.18, 'value': 0, 'price': 373.7, 'pc': -1.66}, {'name': 'LSNG', 'name_rus': 'РСетиЛЭ-п', 'volume': 5.87, 'value': 0, 'price': 196.3, 'pc': -0.51}, {'name': 'RENI', 'name_rus': 'Ренессанс', 'volume': 54.01, 'value': 0, 'price': 95.64, 'pc': -1.4}, {'name': 'RTKM', 'name_rus': 'Ростел -ап', 'volume': 119.97, 'value': 0, 'price': 76.6, 'pc': 0.72}, {'name': 'ETLN', 'name_rus': 'ETLN-гдр', 'volume': 20.87, 'value': 0, 'price': 79.5, 'pc': -1.46}, {'name': 'HHR', 'name_rus': 'iHHRU-адр', 'volume': 14.38, 'value': 0, 'price': 3596.0, 'pc': -0.11}, {'name': 'NKNC', 'name_rus': 'НКНХ ап', 'volume': 20.69, 'value': 0, 'price': 77.0, 'pc': -2.7}, {'name': 'GEMC', 'name_rus': 'GEMC-гдр', 'volume': 5.27, 'value': 0, 'price': 834.8, 'pc': -0.74}, {'name': 'AQUA', 'name_rus': 'ИНАРКТИКА', 'volume': 32.18, 'value': 0, 'price': 944.0, 'pc': 0.05}, {'name': 'LSRG', 'name_rus': 'ЛСР ао', 'volume': 12.51, 'value': 0, 'price': 662.4, 'pc': -1.46}, {'name': 'NKHP', 'name_rus': 'НКХП ао', 'volume': 78.67, 'value': 0, 'price': 952.0, 'pc': -4.8}, {'name': 'FIXP', 'name_rus': 'FIXP-гдр', 'volume': 111.71, 'value': 0, 'price': 312.5, 'pc': -2.86}, {'name': 'OGKB', 'name_rus': 'ОГК-2 ао', 'volume': 35.9, 'value': 0, 'price': 0.543, 'pc': -2.11}, {'name': 'MGTS', 'name_rus': 'МГТС-4ап', 'volume': 1.9, 'value': 0, 'price': 1526.0, 'pc': -0.91}, {'name': 'APTK', 'name_rus': 'Аптеки36и6', 'volume': 14.77, 'value': 0, 'price': 14.186, 'pc': -1.28}, {'name': 'MRKP', 'name_rus': 'РСетиЦП ао', 'volume': 15.6, 'value': 0, 'price': 0.3185, 'pc': -1.24}, {'name': 'RNFT', 'name_rus': 'РуссНфт ао', 'volume': 26.7, 'value': 0, 'price': 156.0, 'pc': -0.13}, {'name': 'MSRS', 'name_rus': 'РСетиМР ао', 'volume': 10.41, 'value': 0, 'price': 1.2665, 'pc': -0.86}, {'name': 'MDMG', 'name_rus': 'MDMG-гдр', 'volume': 4.31, 'value': 0, 'price': 811.9, 'pc': 0.36}, {'name': 'SFIN', 'name_rus': 'ЭсЭфАй ао', 'volume': 19.64, 'value': 0, 'price': 571.0, 'pc': 1.35}, {'name': 'TGKA', 'name_rus': 'ТГК-1', 'volume': 75.03, 'value': 0, 'price': 0.009588, 'pc': -2.86}, {'name': 'ELFV', 'name_rus': 'ЭЛ5Энер ао', 'volume': 47.27, 'value': 0, 'price': 0.6496, 'pc': -2.58}, {'name': 'MVID', 'name_rus': 'М.видео', 'volume': 41.78, 'value': 0, 'price': 177.3, 'pc': -1.94}, {'name': 'MRKC', 'name_rus': 'РоссЦентр', 'volume': 15.75, 'value': 0, 'price': 0.5842, 'pc': -1.85}, {'name': 'BELU', 'name_rus': 'НоваБев ао', 'volume': 93.27, 'value': 0, 'price': 5508.0, 'pc': -0.31}, {'name': 'MRKU', 'name_rus': 'Россети Ур', 'volume': 5.08, 'value': 0, 'price': 0.3958, 'pc': -1.25}, {'name': 'SVAV', 'name_rus': 'СОЛЛЕРС', 'volume': 37.15, 'value': 0, 'price': 759.0, 'pc': -2.5}, {'name': 'CIAN', 'name_rus': 'CIAN-адр', 'volume': 36.25, 'value': 0, 'price': 672.4, 'pc': -3.0}, {'name': 'RKKE', 'name_rus': 'ЭнергияРКК', 'volume': 10.34, 'value': 0, 'price': 23220.0, 'pc': 1.09}, {'name': 'DVEC', 'name_rus': 'ДЭК ао', 'volume': 12.43, 'value': 0, 'price': 3.27, 'pc': -2.97}, {'name': 'WUSH', 'name_rus': 'iВУШХолднг', 'volume': 80.39, 'value': 0, 'price': 236.1, 'pc': -0.71}, {'name': 'TGKB', 'name_rus': 'ТГК-2', 'volume': 20.9, 'value': 0, 'price': 0.01132, 'pc': -2.96}, {'name': 'KZOS', 'name_rus': 'ОргСинт ап', 'volume': 10.86, 'value': 0, 'price': 26.3, 'pc': -4.92}, {'name': 'MRKZ', 'name_rus': 'РСетиСЗ ао', 'volume': 10.27, 'value': 0, 'price': 0.092, 'pc': -3.97}, {'name': 'MRKV', 'name_rus': 'РсетВол ао', 'volume': 15.84, 'value': 0, 'price': 0.0546, 'pc': 0.46}, {'name': 'CHMK', 'name_rus': 'ЧМК ао', 'volume': 1.76, 'value': 0, 'price': 10340.0, 'pc': -0.96}, {'name': 'TTLK', 'name_rus': 'Таттел. ао', 'volume': 9.09, 'value': 0, 'price': 1.061, 'pc': -2.66}, {'name': 'SPBE', 'name_rus': 'СПБ Биржа', 'volume': 1145.74, 'value': 0, 'price': 88.0, 'pc': -10.2}, {'name': 'ISKJ', 'name_rus': 'iАРТГЕН ао', 'volume': 6.28, 'value': 0, 'price': 96.1, 'pc': -0.93}, {'name': 'OKEY', 'name_rus': 'OKEY-гдр', 'volume': 2.78, 'value': 0, 'price': 34.54, 'pc': -0.55}]}, {'name': 'MCXSM', 'children': [{'name': 'HHR', 'name_rus': 'iHHRU-адр', 'volume': 14.42, 'value': 0, 'price': 3595.0, 'pc': -0.14}, {'name': 'POLY', 'name_rus': 'Polymetal', 'volume': 1150.06, 'value': 0, 'price': 424.4, 'pc': 7.31}, {'name': 'RTKM', 'name_rus': 'Ростел -ао', 'volume': 95.63, 'value': 0, 'price': 81.24, 'pc': 0.45}, {'name': 'VKCO', 'name_rus': 'МКПАО "ВК"', 'volume': 376.87, 'value': 0, 'price': 618.2, 'pc': -1.28}, {'name': 'GLTR', 'name_rus': 'GLTR-гдр', 'volume': 39.96, 'value': 0, 'price': 620.3, 'pc': 0.35}, {'name': 'MTLR', 'name_rus': 'Мечел ао', 'volume': 2996.16, 'value': 0, 'price': 301.5, 'pc': -2.6}, {'name': 'AFKS', 'name_rus': 'Система ао', 'volume': 53.31, 'value': 0, 'price': 16.624, 'pc': -0.31}, {'name': 'AGRO', 'name_rus': 'AGRO-гдр', 'volume': 85.19, 'value': 0, 'price': 1486.8, 'pc': -0.92}, {'name': 'FLOT', 'name_rus': 'Совкомфлот', 'volume': 561.55, 'value': 0, 'price': 131.11, 'pc': 1.55}, {'name': 'FEES', 'name_rus': 'Россети', 'volume': 189.99, 'value': 0, 'price': 0.1164, 'pc': -1.34}, {'name': 'AFLT', 'name_rus': 'Аэрофлот', 'volume': 46.94, 'value': 0, 'price': 38.27, 'pc': -0.62}, {'name': 'BSPB', 'name_rus': 'БСП ао', 'volume': 241.16, 'value': 0, 'price': 236.8, 'pc': -2.15}, {'name': 'GEMC', 'name_rus': 'GEMC-гдр', 'volume': 5.28, 'value': 0, 'price': 835.0, 'pc': -0.71}, {'name': 'MTLR', 'name_rus': 'Мечел ап', 'volume': 453.41, 'value': 0, 'price': 358.6, 'pc': -1.66}, {'name': 'SMLT', 'name_rus': 'Самолет ао', 'volume': 77.96, 'value': 0, 'price': 3987.5, 'pc': -0.13}, {'name': 'MSNG', 'name_rus': '+МосЭнерго', 'volume': 10.13, 'value': 0, 'price': 3.05, 'pc': 0.54}, {'name': 'UPRO', 'name_rus': 'Юнипро ао', 'volume': 92.65, 'value': 0, 'price': 2.147, 'pc': -1.24}, {'name': 'BELU', 'name_rus': 'НоваБев ао', 'volume': 93.41, 'value': 0, 'price': 5508.0, 'pc': -0.31}, {'name': 'FESH', 'name_rus': 'ДВМП ао', 'volume': 264.77, 'value': 0, 'price': 80.99, 'pc': -3.39}, {'name': 'MDMG', 'name_rus': 'MDMG-гдр', 'volume': 4.36, 'value': 0, 'price': 812.0, 'pc': 0.37}, {'name': 'SELG', 'name_rus': 'Селигдар', 'volume': 117.34, 'value': 0, 'price': 68.95, 'pc': -2.3}, {'name': 'POSI', 'name_rus': 'iПозитив', 'volume': 54.51, 'value': 0, 'price': 2145.4, 'pc': -0.11}, {'name': 'RASP', 'name_rus': 'Распадская', 'volume': 206.19, 'value': 0, 'price': 373.55, 'pc': -1.7}, {'name': 'LENT', 'name_rus': 'Лента ао', 'volume': 2.19, 'value': 0, 'price': 712.0, 'pc': -0.14}, {'name': 'LSRG', 'name_rus': 'ЛСР ао', 'volume': 12.9, 'value': 0, 'price': 663.2, 'pc': -1.34}, {'name': 'QIWI', 'name_rus': 'iQIWI', 'volume': 8.37, 'value': 0, 'price': 547.5, 'pc': -0.9}, {'name': 'ETLN', 'name_rus': 'ETLN-гдр', 'volume': 20.91, 'value': 0, 'price': 79.48, 'pc': -1.49}, {'name': 'SGZH', 'name_rus': 'Сегежа', 'volume': 441.84, 'value': 0, 'price': 3.9, 'pc': -1.02}, {'name': 'CIAN', 'name_rus': 'CIAN-адр', 'volume': 36.35, 'value': 0, 'price': 672.4, 'pc': -3.0}, {'name': 'OGKB', 'name_rus': 'ОГК-2 ао', 'volume': 36.37, 'value': 0, 'price': 0.5434, 'pc': -2.04}, {'name': 'AQUA', 'name_rus': 'ИНАРКТИКА', 'volume': 32.25, 'value': 0, 'price': 945.0, 'pc': 0.16}, {'name': 'RTKM', 'name_rus': 'Ростел -ап', 'volume': 123.08, 'value': 0, 'price': 76.6, 'pc': 0.72}, {'name': 'RENI', 'name_rus': 'Ренессанс', 'volume': 54.11, 'value': 0, 'price': 95.62, 'pc': -1.42}, {'name': 'MRKP', 'name_rus': 'РСетиЦП ао', 'volume': 15.71, 'value': 0, 'price': 0.3184, 'pc': -1.27}, {'name': 'MRKC', 'name_rus': 'РоссЦентр', 'volume': 15.91, 'value': 0, 'price': 0.5836, 'pc': -1.95}, {'name': 'MVID', 'name_rus': 'М.видео', 'volume': 41.91, 'value': 0, 'price': 177.5, 'pc': -1.83}, {'name': 'ELFV', 'name_rus': 'ЭЛ5Энер ао', 'volume': 47.82, 'value': 0, 'price': 0.6492, 'pc': -2.64}, {'name': 'TGKA', 'name_rus': 'ТГК-1', 'volume': 75.26, 'value': 0, 'price': 0.009594, 'pc': -2.8}, {'name': 'RNFT', 'name_rus': 'РуссНфт ао', 'volume': 26.7, 'value': 0, 'price': 156.0, 'pc': -0.13}, {'name': 'APTK', 'name_rus': 'Аптеки36и6', 'volume': 14.8, 'value': 0, 'price': 14.186, 'pc': -1.28}, {'name': 'MSRS', 'name_rus': 'РСетиМР ао', 'volume': 10.54, 'value': 0, 'price': 1.266, 'pc': -0.9}]}, {'name': 'MOEXMM', 'children': [{'name': 'GMKN', 'name_rus': 'ГМКНорНик', 'volume': 338.7, 'value': 0, 'price': 17184.0, 'pc': 0.51}, {'name': 'PLZL', 'name_rus': 'Полюс', 'volume': 86.4, 'value': 0, 'price': 11197.0, 'pc': -0.07}, {'name': 'RUAL', 'name_rus': 'РУСАЛ ао', 'volume': 113.97, 'value': 0, 'price': 37.88, 'pc': -0.25}, {'name': 'CHMF', 'name_rus': 'СевСт-ао', 'volume': 245.4, 'value': 0, 'price': 1304.0, 'pc': -1.0}, {'name': 'NLMK', 'name_rus': 'НЛМК ао', 'volume': 515.09, 'value': 0, 'price': 178.6, 'pc': -1.97}, {'name': 'MAGN', 'name_rus': 'ММК', 'volume': 90.25, 'value': 0, 'price': 51.87, 'pc': 0.46}, {'name': 'ALRS', 'name_rus': 'АЛРОСА ао', 'volume': 111.1, 'value': 0, 'price': 66.2, 'pc': 0.29}, {'name': 'ENPG', 'name_rus': 'ЭН+ГРУП ао', 'volume': 36.23, 'value': 0, 'price': 470.0, 'pc': -1.47}, {'name': 'MTLR', 'name_rus': 'Мечел ао', 'volume': 2996.16, 'value': 0, 'price': 301.5, 'pc': -2.6}, {'name': 'VSMO', 'name_rus': 'ВСМПО-АВСМ', 'volume': 35.5, 'value': 0, 'price': 34160.0, 'pc': -3.77}, {'name': 'MTLR', 'name_rus': 'Мечел ап', 'volume': 453.41, 'value': 0, 'price': 358.6, 'pc': -1.66}, {'name': 'SELG', 'name_rus': 'Селигдар', 'volume': 117.34, 'value': 0, 'price': 68.95, 'pc': -2.3}, {'name': 'POLY', 'name_rus': 'Polymetal', 'volume': 1150.06, 'value': 0, 'price': 424.4, 'pc': 7.31}, {'name': 'RASP', 'name_rus': 'Распадская', 'volume': 206.19, 'value': 0, 'price': 373.55, 'pc': -1.7}]}, {'name': 'MOEXOG', 'children': [{'name': 'LKOH', 'name_rus': 'ЛУКОЙЛ', 'volume': 1145.65, 'value': 0, 'price': 7320.0, 'pc': 0.34}, {'name': 'ROSN', 'name_rus': 'Роснефть', 'volume': 352.84, 'value': 0, 'price': 582.65, 'pc': 0.66}, {'name': 'GAZP', 'name_rus': 'ГАЗПРОМ ао', 'volume': 1082.62, 'value': 0, 'price': 164.29, 'pc': -0.25}, {'name': 'TATN', 'name_rus': 'Татнфт 3ао', 'volume': 474.39, 'value': 0, 'price': 647.7, 'pc': -0.05}, {'name': 'NVTK', 'name_rus': 'Новатэк ао', 'volume': 156.66, 'value': 0, 'price': 1515.8, 'pc': 0.12}, {'name': 'SNGS', 'name_rus': 'Сургнфгз', 'volume': 53.22, 'value': 0, 'price': 31.98, 'pc': -0.25}, {'name': 'SNGS', 'name_rus': 'Сургнфгз-п', 'volume': 191.13, 'value': 0, 'price': 58.48, 'pc': -0.1}, {'name': 'TRNFP', 'name_rus': 'Транснф ап', 'volume': 354.56, 'value': 0, 'price': 146350.0, 'pc': 0.69}, {'name': 'BANE', 'name_rus': 'Башнефт ап', 'volume': 185.19, 'value': 0, 'price': 1769.5, 'pc': 1.23}, {'name': 'TATN', 'name_rus': 'Татнфт 3ап', 'volume': 82.47, 'value': 0, 'price': 646.3, 'pc': -0.25}, {'name': 'RNFT', 'name_rus': 'РуссНфт ао', 'volume': 27.22, 'value': 0, 'price': 156.1, 'pc': -0.06}]}, {'name': 'MOEXFN', 'children': [{'name': 'MOEX', 'name_rus': 'МосБиржа', 'volume': 599.11, 'value': 0, 'price': 207.91, 'pc': 1.23}, {'name': 'CBOM', 'name_rus': 'МКБ ао', 'volume': 27.13, 'value': 0, 'price': 7.652, 'pc': -0.17}, {'name': 'TCSG', 'name_rus': 'TCS-гдр', 'volume': 247.5, 'value': 0, 'price': 3444.5, 'pc': -0.71}, {'name': 'SBER', 'name_rus': 'Сбербанк', 'volume': 4187.41, 'value': 0, 'price': 288.12, 'pc': 0.44}, {'name': 'VTBR', 'name_rus': 'ВТБ ао', 'volume': 319.92, 'value': 0, 'price': 0.024845, 'pc': 0.0}, {'name': 'QIWI', 'name_rus': 'iQIWI', 'volume': 8.39, 'value': 0, 'price': 547.0, 'pc': -1.0}, {'name': 'BSPB', 'name_rus': 'БСП ао', 'volume': 241.59, 'value': 0, 'price': 237.03, 'pc': -2.05}, {'name': 'RENI', 'name_rus': 'Ренессанс', 'volume': 54.25, 'value': 0, 'price': 95.64, 'pc': -1.4}, {'name': 'SBER', 'name_rus': 'Сбербанк-п', 'volume': 292.02, 'value': 0, 'price': 287.91, 'pc': 0.53}, {'name': 'SFIN', 'name_rus': 'ЭсЭфАй ао', 'volume': 20.07, 'value': 0, 'price': 571.4, 'pc': 1.42}, {'name': 'SPBE', 'name_rus': 'СПБ Биржа', 'volume': 1148.96, 'value': 0, 'price': 87.8, 'pc': -10.41}]}, {'name': 'MOEXCN', 'children': [{'name': 'AGRO', 'name_rus': 'AGRO-гдр', 'volume': 85.28, 'value': 0, 'price': 1486.8, 'pc': -0.92}, {'name': 'MGNT', 'name_rus': 'Магнит ао', 'volume': 1869.96, 'value': 0, 'price': 6327.5, 'pc': 0.07}, {'name': 'FIVE', 'name_rus': 'FIVE-гдр', 'volume': 61.93, 'value': 0, 'price': 2174.0, 'pc': -0.23}, {'name': 'LENT', 'name_rus': 'Лента ао', 'volume': 2.19, 'value': 0, 'price': 712.0, 'pc': -0.14}, {'name': 'GEMC', 'name_rus': 'GEMC-гдр', 'volume': 5.28, 'value': 0, 'price': 835.0, 'pc': -0.71}, {'name': 'AQUA', 'name_rus': 'ИНАРКТИКА', 'volume': 32.33, 'value': 0, 'price': 944.5, 'pc': 0.11}, {'name': 'FIXP', 'name_rus': 'FIXP-гдр', 'volume': 112.64, 'value': 0, 'price': 312.5, 'pc': -2.86}, {'name': 'APTK', 'name_rus': 'Аптеки36и6', 'volume': 14.81, 'value': 0, 'price': 14.186, 'pc': -1.28}, {'name': 'MDMG', 'name_rus': 'MDMG-гдр', 'volume': 4.38, 'value': 0, 'price': 812.0, 'pc': 0.37}, {'name': 'MVID', 'name_rus': 'М.видео', 'volume': 42.01, 'value': 0, 'price': 177.4, 'pc': -1.88}, {'name': 'BELU', 'name_rus': 'НоваБев ао', 'volume': 94.01, 'value': 0, 'price': 5512.0, 'pc': -0.24}, {'name': 'SVAV', 'name_rus': 'СОЛЛЕРС', 'volume': 37.71, 'value': 0, 'price': 762.5, 'pc': -2.06}, {'name': 'WUSH', 'name_rus': 'iВУШХолднг', 'volume': 81.14, 'value': 0, 'price': 235.9, 'pc': -0.8}, {'name': 'ISKJ', 'name_rus': 'iАРТГЕН ао', 'volume': 6.28, 'value': 0, 'price': 96.06, 'pc': -0.97}, {'name': 'OKEY', 'name_rus': 'OKEY-гдр', 'volume': 2.8, 'value': 0, 'price': 34.59, 'pc': -0.4}]}, {'name': 'MOEXTN', 'children': [{'name': 'FLOT', 'name_rus': 'Совкомфлот', 'volume': 562.54, 'value': 0, 'price': 131.07, 'pc': 1.52}, {'name': 'AFLT', 'name_rus': 'Аэрофлот', 'volume': 47.17, 'value': 0, 'price': 38.27, 'pc': -0.62}, {'name': 'FESH', 'name_rus': 'ДВМП ао', 'volume': 266.71, 'value': 0, 'price': 80.98, 'pc': -3.4}, {'name': 'NMTP', 'name_rus': 'НМТП ао', 'volume': 120.51, 'value': 0, 'price': 11.07, 'pc': -2.04}, {'name': 'GLTR', 'name_rus': 'GLTR-гдр', 'volume': 40.92, 'value': 0, 'price': 619.8, 'pc': 0.27}, {'name': 'NKHP', 'name_rus': 'НКХП ао', 'volume': 79.06, 'value': 0, 'price': 953.5, 'pc': -4.65}]}, {'name': 'MOEXEU', 'children': [{'name': 'IRAO', 'name_rus': 'ИнтерРАОао', 'volume': 63.02, 'value': 0, 'price': 4.237, 'pc': 0.19}, {'name': 'FEES', 'name_rus': 'Россети', 'volume': 190.86, 'value': 0, 'price': 0.11642, 'pc': -1.32}, {'name': 'MSNG', 'name_rus': '+МосЭнерго', 'volume': 10.19, 'value': 0, 'price': 3.05, 'pc': 0.54}, {'name': 'UPRO', 'name_rus': 'Юнипро ао', 'volume': 92.73, 'value': 0, 'price': 2.145, 'pc': -1.33}, {'name': 'HYDR', 'name_rus': 'РусГидро', 'volume': 176.24, 'value': 0, 'price': 0.8127, 'pc': 2.41}, {'name': 'LSNG', 'name_rus': 'РСетиЛЭ-п', 'volume': 5.98, 'value': 0, 'price': 196.0, 'pc': -0.66}, {'name': 'OGKB', 'name_rus': 'ОГК-2 ао', 'volume': 36.41, 'value': 0, 'price': 0.5435, 'pc': -2.02}, {'name': 'MRKP', 'name_rus': 'РСетиЦП ао', 'volume': 15.76, 'value': 0, 'price': 0.3183, 'pc': -1.3}, {'name': 'MSRS', 'name_rus': 'РСетиМР ао', 'volume': 10.57, 'value': 0, 'price': 1.2675, 'pc': -0.78}, {'name': 'TGKA', 'name_rus': 'ТГК-1', 'volume': 75.28, 'value': 0, 'price': 0.00959, 'pc': -2.84}, {'name': 'ELFV', 'name_rus': 'ЭЛ5Энер ао', 'volume': 47.88, 'value': 0, 'price': 0.6492, 'pc': -2.64}, {'name': 'MRKC', 'name_rus': 'РоссЦентр', 'volume': 15.94, 'value': 0, 'price': 0.5844, 'pc': -1.81}, {'name': 'MRKU', 'name_rus': 'Россети Ур', 'volume': 5.23, 'value': 0, 'price': 0.3962, 'pc': -1.15}, {'name': 'DVEC', 'name_rus': 'ДЭК ао', 'volume': 12.49, 'value': 0, 'price': 3.27, 'pc': -2.97}, {'name': 'TGKB', 'name_rus': 'ТГК-2', 'volume': 21.09, 'value': 0, 'price': 0.011225, 'pc': -3.77}, {'name': 'MRKV', 'name_rus': 'РсетВол ао', 'volume': 15.97, 'value': 0, 'price': 0.0546, 'pc': 0.46}, {'name': 'MRKZ', 'name_rus': 'РСетиСЗ ао', 'volume': 10.32, 'value': 0, 'price': 0.09175, 'pc': -4.23}]}, {'name': 'MOEXTL', 'children': [{'name': 'MTSS', 'name_rus': 'МТС-ао', 'volume': 180.77, 'value': 0, 'price': 262.55, 'pc': -0.11}, {'name': 'RTKM', 'name_rus': 'Ростел -ао', 'volume': 96.51, 'value': 0, 'price': 81.23, 'pc': 0.43}, {'name': 'MGTS', 'name_rus': 'МГТС-4ап', 'volume': 2.02, 'value': 0, 'price': 1528.0, 'pc': -0.78}, {'name': 'RTKM', 'name_rus': 'Ростел -ап', 'volume': 124.36, 'value': 0, 'price': 76.6, 'pc': 0.72}, {'name': 'TTLK', 'name_rus': 'Таттел. ао', 'volume': 9.16, 'value': 0, 'price': 1.06, 'pc': -2.75}]}, {'name': 'MOEXINN', 'children': [{'name': 'POSI', 'name_rus': 'iПозитив', 'volume': 55.14, 'value': 0, 'price': 2144.8, 'pc': -0.14}, {'name': 'UNAC', 'name_rus': 'iАвиастКао', 'volume': 19.89, 'value': 0, 'price': 1.395, 'pc': -0.29}, {'name': 'QIWI', 'name_rus': 'iQIWI', 'volume': 8.39, 'value': 0, 'price': 546.0, 'pc': -1.18}, {'name': 'HHR', 'name_rus': 'iHHRU-адр', 'volume': 14.64, 'value': 0, 'price': 3580.0, 'pc': -0.56}, {'name': 'WUSH', 'name_rus': 'iВУШХолднг', 'volume': 81.4, 'value': 0, 'price': 235.99, 'pc': -0.76}, {'name': 'ISKJ', 'name_rus': 'iАРТГЕН ао', 'volume': 6.29, 'value': 0, 'price': 96.08, 'pc': -0.95}, {'name': 'LIFE', 'name_rus': 'iФармсинтз', 'volume': 37.12, 'value': 0, 'price': 4.855, 'pc': -2.9}, {'name': 'GECO', 'name_rus': 'iГЕНЕТИКО', 'volume': 10.81, 'value': 0, 'price': 45.92, 'pc': -0.58}, {'name': 'NAUK', 'name_rus': 'iНПОНаука', 'volume': 4.11, 'value': 0, 'price': 589.0, 'pc': -3.44}, {'name': 'NSVZ', 'name_rus': 'iНаукаСвяз', 'volume': 38.05, 'value': 0, 'price': 574.5, 'pc': 4.17}, {'name': 'GEMA', 'name_rus': 'iММЦБ ао', 'volume': 0.47, 'value': 0, 'price': 1031.0, 'pc': 0.24}]}, {'name': 'MOEXCH', 'children': [{'name': 'KAZT', 'name_rus': 'Куйбазот', 'volume': 18.88, 'value': 0, 'price': 708.0, 'pc': 2.08}, {'name': 'PHOR', 'name_rus': 'ФосАгро ао', 'volume': 42.23, 'value': 0, 'price': 6734.0, 'pc': -0.31}, {'name': 'AKRN', 'name_rus': 'Акрон', 'volume': 2.86, 'value': 0, 'price': 18830.0, 'pc': -0.53}, {'name': 'KZOS', 'name_rus': 'ОргСинт ао', 'volume': 15.05, 'value': 0, 'price': 107.8, 'pc': -3.84}, {'name': 'NKNC', 'name_rus': 'НКНХ ао', 'volume': 27.22, 'value': 0, 'price': 106.7, 'pc': -5.99}, {'name': 'NKNC', 'name_rus': 'НКНХ ап', 'volume': 20.74, 'value': 0, 'price': 77.0, 'pc': -2.7}, {'name': 'KZOS', 'name_rus': 'ОргСинт ап', 'volume': 10.98, 'value': 0, 'price': 26.3, 'pc': -4.92}]}]}


let chartDiv = document.getElementById("chart");
let svg = d3.select(chartDiv).append("svg");

let format = d3.format(",d");

let colors = [
  "#AA2121",    // 0
  "#C84040",    // 1
  "#ED7171",    // 2
  "#7EC17E",    // 3
  "#518651",    // 4
  "#215E2C"     // 5
];

function getColor(val) {
  let color = "lightgray"
  if (val <= -3) {color = colors[1];}
  if (val <= -10) {color = colors[0];}
  if (val > -3 && val < 0) {color = colors[2];}

  if (val >= 3) {color = colors[4];}
  if (val >= 10) {color = colors[5];}
  if (val >= 0 && val < 3) {color = colors[3];}
  return color
}

var tooltip = d3.select("#chart").append("div")
  .attr("class", "tooltip")
  .style("opacity", 0);

function redraw() {
  var width = chartDiv.clientWidth;
  var height = chartDiv.clientHeight;

  d3.select("svg").html("");

  let chart = () => {
    const root = treemap(filteredData);

    const svg = d3.select("svg");

    svg
      .attr("width", width)
      .attr("height", height)
      .classed("svg-content-responsive", true);

    const leaf = svg
      .selectAll("g")
      .data(root.leaves())
      .enter()
      .append("g")
      .attr("transform", d => `translate(${d.x0},${d.y0})`)
      .on("mousemove", function (d) {
        // console.log(d)
        tooltip.transition()
          .duration(300)
          .style("opacity", .98);
        tooltip.html(`<div class="tooltip-body" data-id=${d.data.name} >
          <ul>
            <li><b>${d.data.name_rus}</b></li>
            <li>Тикер: ${d.data.name}</li>
            <li>Цена: ${d.data.price}</li>
            <li>Дельта: ${d.data.pc}%</li>
            <li># todo line chart</li>
          </ul>
          
      </div>`)
          .style("left", (d3.event.pageX + 10) + "px")
          .style("top", (d3.event.pageY + 10) + "px");
      })
      .on("mouseout", function (d) {
        tooltip.transition()
          .duration(500)
          .style("opacity", 0);
      });

    // leaf.append("title").text(
    //   d =>
    //     `${d
    //       .ancestors()
    //       .reverse()
    //       .map(d => d.data.name)
    //       .join("/")}\n${format(d.value)}`
    // );

    leaf
      .append("rect")
      .attr("id", d => (d.leafUid = "#leaf").id)
      .attr("fill", (d) => getColor(d.data.pc))
      .attr("fill-opacity", 1.0)
      .attr("width", d => d.x1 - d.x0)
      .attr("height", d => d.y1 - d.y0)
      .attr("class", (d) => "node level-" + d.depth);
    // .on("mouseover", (d) => {
    //   d3.select(this)
    //     .style("stroke", "yellow")
    //     .style("opacity", 1)
    //  });

    // leaf.append("clipPath")
    //     .attr("id", d => (d.clipUid = ("#clip")).id)
    //     .append("use")
    //     .attr("xlink:href", d => d.leafUid.href);

    let txt = leaf
      .append("text")
      .attr("fill", "#fff")
      .attr("text-anchor", "middle")
      .attr("class", "shadow")
      // .attr("dy", "1.7em")
      .attr("y", function () {
        const parentData = d3.select(this.parentNode).datum();
        return (parentData.y1 - parentData.y0) / 2;
      })
      // .attr("x", "1.7em")
      // .attr("unicode-bidi","isolate-override")
      .attr("font-size", d => Math.min(d.x1 - d.x0, d.y1 - d.y0) / 6);


    // Add a <tspan class="title"> for every data element.
    txt.append("tspan")
      .text(d => d.data.name)
      .attr("class", "title")
      .attr("dy", "-1.5em")
      .attr("x", function () {
        const parentData = d3.select(this.parentNode).datum();
        return (parentData.x1 - parentData.x0) / 2;
      });

    // Add a <tspan class="author"> for every data element.
    txt.append("tspan")
      .text(d => `${d.data.price} ₽`)
      .attr("class", "price")
      .attr("dy", "1.4em")
      .attr("x", function () {
        const parentData = d3.select(this.parentNode).datum();
        return (parentData.x1 - parentData.x0) / 2;
      });

    // Add a <tspan class="author"> for every data element.
    txt.append("tspan")
      .text(d => (d.data.pc > 0) ? `+${d.data.pc}%` : `${d.data.pc}%`)
      .attr("class", "percent")
      .attr("dy", "1.4em")
      .attr("x", function () {
        const parentData = d3.select(this.parentNode).datum();
        return (parentData.x1 - parentData.x0) / 2;
      });

    // Add a <tspan class="text"> for every text line.
    // txt.selectAll("tspan.text")
    //     .data(d => d.text.split("\n"))
    //     .enter()
    //     .append("tspan")
    //     .attr("class", "text")
    //     .text(d => d)
    //     .attr("dy", "1.1em")
    //     .attr("x", function() {
    //       const parentData = d3.select(this.parentNode).datum();
    //       return (parentData.x1 - parentData.x0) / 2;
    //     });  

    //       .selectAll("tspan")
    //       .data(d =>
    //         d.data.name
    //           .split(/(?=[A-Z][^A-Z])/g)
    //           .concat(format(d.data.volume))
    //           .concat("+%"+format(d.data.pc))
    //       )
    //       .enter()
    //       .append("tspan")
    //       // .style("width", d => d.x1 - d.x0)
    //       // .style("height", d => d.y1 - d.y0)
    //       // .attr("direction" ,"rtl")
    //       // .attr("xml:lang","fa")
    //       // .attr("unicode-bidi","bidi-override")
    //       // .attr("transform", "(250 250 250 250)")
    //       // .style("text-anchor", "start")
    //       // .attr("dominant-baseline", "central")
    //       // .attr("y", function() {
    //       //   const parentData = d3.select(this.parentNode).datum();
    //       //   return (parentData.y1 - parentData.y0) / 2;
    //       // })
    //       .attr("dy", "1.4em")
    //       .attr("x", function() {
    //         const parentData = d3.select(this.parentNode).datum();
    //         return (parentData.x1 - parentData.x0) / 2;
    //       })
    //       .attr("font-weight", (d, i, nodes) =>
    //         i === nodes.length - 1 ? "400" : "700"
    //       )
    //       .text(d => d);





    // Add title for the top level
    svg
      .selectAll("titles")
      .data(
        root.descendants().filter(function (d) {
          return d.depth == 1;
        })
      )
      .enter()
      .append('g')
      .attr("x", (d) => d.x0)
      .attr("y", (d) => d.y0)
      .attr("dx", (d) => d.x0 + d.x1)
      .attr("dy", (d) => d.y0 + d.y1)
      .append("text")
      .attr("x", (d) => d.x0 + 3)
      .attr("y", (d) => d.y0 + 18)
      .text((d) => d.data.name)
      // .attr("font-size", d => Math.max(d.x1 - d.x0, d.y1 - d.y0) / 22)
      .attr("font-size", "16px")
      .attr("font-weight", "400")
      .attr("fill", "#fff");

    return svg.node();
  };

  let filteredData = d3
    .hierarchy(data)
    .sum(d => d.volume)
    .sort((a, b) => b.height - a.height || b.value - a.value);

  let reg = d3.selectAll("input[name='dtype']").on("change", function () {
    let dtype = this.value;
  });

  let treemap = d3
    .treemap()
    .size([width, height])
    .padding(1)
    .paddingRight(3)
    .paddingTop(25)
    .round(true);

  // let charsts = d3.select("#chart");

  let format = d3.format(",d");

  chart();
}

// Draw for the first time to initialize.
redraw();

// Redraw based on the new size whenever the browser window is resized.
window.addEventListener("resize", redraw);
